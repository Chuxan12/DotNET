<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–µ - –ê–Ω–∏–º–µ–°–∞–π—Ç</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* CSS —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        .container {
            background: #fff;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: auto;
            position: relative;
        }

        h1 {
            text-align: center;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 97%;
            padding: 10px;
            border: 1px solid #ccc;
        }

        .error {
            color: red;
            font-size: 14px;
            display: none;
            position: absolute;
            bottom: -20px;
            left: 0;
        }

        .submit-button {
            background-color: #007BFF;
            color: white;
            padding: 10px;
            border: none;
            cursor: pointer;
            width: 100%;
        }

        .submit-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="logo">–ê–Ω–∏–º–µ–°–∞–π—Ç</div>
    
        <div class="search-container" role="search">
            <form id="searchForm" class="search-form" autocomplete="off" aria-label="–ü–æ–∏—Å–∫ –∞–Ω–∏–º–µ">
                <input
                        type="text"
                        id="searchInput"
                        class="search-input"
                        placeholder="–ù–∞–π—Ç–∏ –∞–Ω–∏–º–µ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..."
                        aria-autocomplete="list"
                        aria-controls="suggestions"
                        aria-expanded="false"
                />
                <button type="submit" class="search-button" aria-label="–ù–∞–π—Ç–∏">üîç</button>
            </form>
            <ul id="suggestions" class="autocomplete-suggestions" role="listbox" aria-label="–ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ–∏—Å–∫–∞"></ul>
        </div>
    
        <nav class="main-nav" aria-label="–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é">
            <ul>
                <li><a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="catalog.html">–ö–∞—Ç–∞–ª–æ–≥</a></li>
                <li><a href="top100.html">–¢–æ–ø-100 –∞–Ω–∏–º–µ</a></li>
                <a href="cart.html" aria-label="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ"> –ò–∑–±—Ä–∞–Ω–Ω–æ–µ <span class="counter">0</span> </a>
                <li>
                    <a href="profile.html" aria-label="–ü—Ä–æ—Ñ–∏–ª—å">
                        <img src="img/avatar.jpg" alt="" class="avatar"/>
                    </a>
                </li>
            </ul>
        </nav>
    </header>
<main>
    <div class="container">
        <p><strong>–î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–µ</strong></p>
        <div class="form-group">
            <label for="title">–ù–∞–∑–≤–∞–Ω–∏–µ –∞–Ω–∏–º–µ:</label>
            <input type="text" id="title" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∞–Ω–∏–º–µ..." required>
            <div class="error" id="title-error">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 100 —Å–∏–º–≤–æ–ª–æ–≤.</div>
        </div>
        <div class="form-group">
            <label for="rating">–û—Ü–µ–Ω–∫–∞:</label>
            <input type="number" id="rating" min="0" max="10" step="0.1" placeholder="–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 10..."
                   required>
            <div class="error" id="rating-error">–û—Ü–µ–Ω–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 0 –¥–æ 10.</div>
        </div>
        <div class="form-group">
            <label for="type">–¢–∏–ø:</label>
            <select id="type" required>
                <option value="TV">TV-—Å–µ—Ä–∏–∞–ª</option>
                <option value="Movie">–§–∏–ª—å–º</option>
                <option value="OVA">OVA</option>
                <option value="ONA">ONA</option>
                <option value="Special">–°–ø–µ—Ü–≤—ã–ø—É—Å–∫</option>
            </select>
        </div>
        <div class="form-group">
            <label for="status">–°—Ç–∞—Ç—É—Å:</label>
            <select id="status" required>
                <option value="Finished">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</option>     <!-- Finished -->
                <option value="Airing">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</option>      <!-- Airing   -->
                <option value="Upcoming">–ê–Ω–æ–Ω—Å–∏—Ä–æ–≤–∞–Ω–æ</option>  <!-- Upcoming -->
            </select>
        </div>
        <div class="form-group">
            <label for="genres">–ñ–∞–Ω—Ä—ã (–∑–∞–∂–º–∏—Ç–µ Ctrl/Cmd –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞):</label>
            <select id="genres" multiple size="4" required>
                <option value="–≠–∫—à–µ–Ω">–≠–∫—à–µ–Ω</option>
                <option value="–¢—Ä–∏–ª–ª–µ—Ä">–¢—Ä–∏–ª–ª–µ—Ä</option>
                <option value="–§—ç–Ω—Ç–µ–∑–∏">–§—ç–Ω—Ç–µ–∑–∏</option>
                <option value="–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è">–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è</option>
                <option value="–î—Ä–∞–º–∞">–î—Ä–∞–º–∞</option>
                <option value="–ò—Å–µ–∫–∞–π">–ò—Å–µ–∫–∞–π</option>
                <option value="–§—ç–Ω—Ç–µ–∑–∏">–§—ç–Ω—Ç–µ–∑–∏</option>
                <option value="–ö–æ–º–µ–¥–∏—è">–ö–æ–º–µ–¥–∏—è</option>
                <option value="–°–µ–Ω–µ–Ω">–°–µ–Ω–µ–Ω</option>
                <!-- –¥–æ–±–∞–≤—å—Ç–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∂–∞–Ω—Ä—ã -->
            </select>
            <div class="error" id="genre-error">–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∂–∞–Ω—Ä.</div>
        </div>
        <div class="form-group">
            <label for="releaseDate">–î–∞—Ç–∞ –≤—ã—Ö–æ–¥–∞:</label>
            <input type="date" id="releaseDate" required>
            <div class="error" id="release-date-error">–î–∞—Ç–∞ –≤—ã—Ö–æ–¥–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞.</div>
        </div>
        <div class="form-group">
            <label for="studio">–°—Ç—É–¥–∏—è:</label>
            <input type="text" id="studio" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—É–¥–∏–∏..." required>
            <div class="error" id="studio-error">–°—Ç—É–¥–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è.</div>
        </div>
        <div class="form-group">
            <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
            <textarea id="description" rows="4" placeholder="–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ, –Ω–µ –º–µ–Ω–µ–µ 20 –±—É–∫–≤..."
                      required></textarea>
            <div class="error" id="description-error">–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 20 —Å–∏–º–≤–æ–ª–æ–≤.</div>
        </div>
        <div class="form-group">
            <label for="imageUrl">URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (JPG/PNG/GIF):</label>
            <input type="url" id="imageUrl" placeholder="https://example.com/image.jpg" required>
            <div class="error" id="image-error">–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.</div>
        </div>
        <button id="submit-button" class="submit-button">–î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–µ</button>
    </div>
</main>
<footer>
    <div>
        <p>&copy; 2024 –ê–Ω–∏–º–µ–°–∞–π—Ç.</p>
        <p>
            <a href="https://t.me" style="color: white; text-decoration: none">–ù–∞—à –∫–∞–Ω–∞–ª –≤ Telegram</a> |
            <a href="about.html" style="color: white; text-decoration: none">–û –Ω–∞—Å</a> |
            <a href="add-item.html" style="color: white; text-decoration: none">–î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–µ</a>
        </p>
    </div>
</footer>

<script>


    document.getElementById('submit-button').addEventListener('click', async e => {
        e.preventDefault();                     // –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é
        /* -------- –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –æ—à–∏–±–æ–∫ -------- */
        document.querySelectorAll('.error').forEach(el => el.style.display = 'none');

        let isValid = true;                     // –æ–±—â–∏–π —Ñ–ª–∞–≥

        /* -------- —Å–±–æ—Ä –ø–æ–ª–µ–π -------- */
        const title = document.getElementById('title').value.trim();
        const rating = +document.getElementById('rating').value;
        const type = document.getElementById('type').value;
        const status = document.getElementById('status').value;
        const studio = document.getElementById('studio').value.trim();
        const descr = document.getElementById('description').value.trim();
        const date = document.getElementById('releaseDate').value;
        const imgUrl = document.getElementById('imageUrl').value.trim();
        const genres = Array.from(document.getElementById('genres').selectedOptions)
            .map(o => o.value);

        /* -------- –±–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è -------- */
        if (!title || title.length > 100) {
            document.getElementById('title-error').style.display = 'block';
            isValid = false;
        }

        if (isNaN(rating) || rating < 0 || rating > 10) {
            document.getElementById('rating-error').style.display = 'block';
            isValid = false;
        }

        if (!genres.length) {
            document.getElementById('genre-error').style.display = 'block';
            isValid = false;
        }

        if (!date) {
            document.getElementById('release-date-error').style.display = 'block';
            isValid = false;
        } else if (new Date(date).getFullYear() <= 1900) {
            const el = document.getElementById('release-date-error');
            el.textContent = '–î–∞—Ç–∞ –≤—ã—Ö–æ–¥–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–∑–∂–µ 1900 –≥–æ–¥–∞.';
            el.style.display = 'block';
            isValid = false;
        }

        if (!studio) {
            document.getElementById('studio-error').style.display = 'block';
            isValid = false;
        }

        if ((descr.match(/[a-zA-Z–∞-—è–ê-–Ø]/g) || []).length < 20) {
            document.getElementById('description-error').style.display = 'block';
            isValid = false;
        }

        if (!/^https?:\/\/.+\.(jpg|jpeg|png|gif)$/i.test(imgUrl)) {
            document.getElementById('image-error').style.display = 'block';
            isValid = false;
        }

        if (!isValid) return;                   // –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è, –µ—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏

        /* -------- –æ—Ç–ø—Ä–∞–≤–∫–∞ -------- */
        try {
            const resp = await fetch('/api/addanime', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    title,
                    rating,
                    type,
                    status,
                    genres,
                    releaseDate: date,
                    studio,
                    description: descr,
                    imageUrl: imgUrl,
                    episodes: 0
                })
            });
            if (!resp.ok) {
                // –ø—Ä–æ–±—É–µ–º –ø—Ä–æ—á–∏—Ç–∞—Ç—å JSON
                let details;
                try {
                    details = await resp.json();
                } catch {
                    details = await resp.text();
                }

                console.error('Backend validation error ‚Üí', details);
                alert(`–û—à–∏–±–∫–∞ ${resp.status}: ${details.message || resp.statusText}`);
                return;
            }

            alert('–ê–Ω–∏–º–µ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ!');
            document.querySelectorAll('input, textarea, select').forEach(el => el.value = '');
            document.getElementById('genres').selectedIndex = -1;   // —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π select
        } catch (ex) {
            alert('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–µ: ' + ex.message);
        }
    });
</script>
</body>
</html>
